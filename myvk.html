<!DOCTYPE html>
<html>
<head>
    <title>Рабочая авторизация VK</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            text-align: center;
            margin-top: 50px;
        }
        button {
            background: #07F;
            color: white;
            border: none;
            padding: 12px 20px;
            border-radius: 4px;
            font-size: 16px;
            cursor: pointer;
        }
        #result {
            margin: 20px;
            padding: 20px;
            border: 1px solid #ddd;
            border-radius: 8px;
            display: inline-block;
        }
        #user-photo {
            border-radius: 50%;
            margin: 10px;
        }
    </style>
</head>
<body>
    <button id="vk-auth">Войти через VK</button>
    <div id="result"></div>

    <script>
        // Конфигурация для GitHub Pages
        const VK_APP_ID = 6121396; // Официальный веб-клиент VK
        const CURRENT_URL = 'https://giraffcontest.github.io/giraff/myvk.html'; // Ваш точный URL
        
        document.getElementById('vk-auth').addEventListener('click', function() {
            // 1. Открываем авторизацию в новом окне
            const authWindow = window.open(
                `https://oauth.vk.com/authorize?` + 
                `client_id=${VK_APP_ID}&` +
                `redirect_uri=${encodeURIComponent('https://oauth.vk.com/blank.html')}&` +
                `display=page&` +
                `scope=friends,photos&` +
                `response_type=token&` +
                `v=5.131`,
                'VK Auth',
                'width=500,height=600'
            );
            
            // 2. Ждем сообщения от окна авторизации
            window.addEventListener('message', function(event) {
                if (event.origin !== 'https://oauth.vk.com') return;
                
                // 3. Получаем токен из URL
                const hash = new URL(event.data).hash.substring(1);
                const params = new URLSearchParams(hash);
                const token = params.get('access_token');
                
                if (token) {
                    // 4. Закрываем окно авторизации
                    authWindow.close();
                    
                    // 5. Показываем результат
                    document.getElementById('result').innerHTML = `
                        <h3>Авторизация успешна!</h3>
                        <p>Токен получен</p>
                        <button onclick="getUserData('${token}')">Загрузить данные</button>
                    `;
                }
            });
        });
        
        // 6. Функция для получения данных пользователя
        function getUserData(token) {
            const script = document.createElement('script');
            script.src = `https://api.vk.com/method/users.get?fields=photo_100&access_token=${token}&v=5.131&callback=showUserData`;
            document.body.appendChild(script);
        }
        
        // 7. Отображение данных пользователя
        window.showUserData = function(data) {
            if (data.error) {
                document.getElementById('result').innerHTML = `
                    <p style="color:red;">Ошибка: ${data.error.error_msg}</p>
                `;
                return;
            }
            
            const user = data.response[0];
            document.getElementById('result').innerHTML = `
                <h2>${user.first_name} ${user.last_name}</h2>
                <img id="user-photo" src="${user.photo_100}">
                <p>ID: ${user.id}</p>
            `;
        };
    </script>
</body>
</html>
